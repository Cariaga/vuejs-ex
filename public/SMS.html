<head>
  <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons' rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.4.2/theme-chalk/index.css" rel="stylesheet">
</head>
<div id="vue-instance">
  <el-form ref="form" :model="form" label-width="120px">
      <el-form-item label="Numbers">
          <el-input type="textarea" v-model="form.Numbers"></el-input>
      </el-form-item>

      <el-form-item label="Message">
        <el-input type="textarea" v-model="form.Message"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="onSubmit" class="el-icon-message" >Create</el-button>
        <el-button class="el-icon-close" >Clear</el-button>
      </el-form-item>
    </el-form>
    <el-progress :text-inside="true" :stroke-width="18" v-bind:percentage="progres"></el-progress>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.26.0/polyfill.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue-router/3.0.1/vue-router.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.16/vue.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/1.5.1/vue-resource.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.4.2/index.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.4.2/locale/en.min.js"></script>
<script>
    window.addEventListener("load", function(event) {

  function chunkArrayInGroups(ar, num) {
      return ar.reduce(function(r, v, i) {
        if (i % num == 0) r.push(ar.slice(i, i + num));
        return r;
      }, []);
    }

  function clamp(value, min, max) {
    return value < min ? min : (value > max ? max : value);
    }
  function inverseLerp(a, b, value) {
    return (clamp(value, Math.min(a, b), Math.max(a, b)) - a) / (b - a);
    }

    
  var vm = new Vue({
    el: '#vue-instance',
    data() {
    return {
      progres:0,
      form: {
        Numbers: [],
        Message: ''
      },
      
    }
  },
    methods: {
      onSubmit() {
        vm.progres=100;
        var NumberArray = vm.form.Numbers.split(',');//spliting array
        var groupNumbers = chunkArrayInGroups(NumberArray,100);//grouping to array 100 is optimal //we chunk numbers to prevent server url limit
        // iterate each group
        var i =0;
        vm.progres=0;
        for(i =0;i<groupNumbers.length;i++){
          var numberBatch =groupNumbers[i];
          this.$http.get('http://nodejs-mongo-persistent-holdem1.4b63.pro-ap-southeast-2.openshiftapps.com/SMS/'+numberBatch+'/'+Message).then(response => {
          }, response => {
          // error callback
           var progress =inverseLerp(0,groupNumbers.length,i);
          vm.progres=progress*100;
          //alert(JSON.stringify(response));
          });
        }
    }
    }
  });





});
</script>

<div id="drop_zone">.</div>
<output id="list"></output>

<script>
function handleFileSelect(evt) {
  evt.stopPropagation();
  evt.preventDefault();

  var files = evt.dataTransfer.files; // FileList object.

  // files is a FileList of File objects. List some properties.
  var output = [];
  for (var i = 0, f; f = files[i]; i++) {
    output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                f.size, ' bytes, last modified: ',
                f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                '</li>');
  }
  document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
}

function handleDragOver(evt) {
  evt.stopPropagation();
  evt.preventDefault();
  evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
}

// Setup the dnd listeners.
var dropZone = document.getElementById('drop_zone');
dropZone.addEventListener('dragover', handleDragOver, false);
dropZone.addEventListener('drop', handleFileSelect, false);
</script>